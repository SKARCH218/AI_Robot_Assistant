<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>DOFBOT Chatbot</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container" style="display:flex; flex-direction:row; justify-content:center; align-items:flex-start; gap:32px; max-width:900px; margin:40px auto;">
        <div style="flex:1; max-width:480px; min-width:340px;">
            <div class="chat-box" id="chat-box" style="margin:0 auto;">
                {% for m in messages %}
                    <div class="{{ m['role'] }}">
                        {% if m['role'] == 'bot' %}
                            <div style="font-size:0.95em; color:#007bff; font-weight:bold; margin-bottom:2px;">DOFBOT</div>
                        {% elif m['role'] == 'user' %}
                            <div style="font-size:0.95em; color:#555; font-weight:bold; margin-bottom:2px; text-align:right;">ÎÇò</div>
                        {% endif %}
                        <span class="bubble">{{ m['content'] }}</span>
                    </div>
                {% endfor %}
            </div>
            <form method="post" autocomplete="off" id="chat-form" {% if vision_enabled %}enctype="multipart/form-data"{% endif %} style="margin-top:16px;">
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <div style="display: flex; gap: 8px;">
                        <input type="text" name="prompt" id="chat-input" autocomplete="off" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." required style="flex: 1;">
                        {% if vision_enabled %}
                        <label for="image-input" style="cursor: pointer; padding: 8px 12px; background: #f0f7ff; border: 1px solid #007bff; border-radius: 4px; color: #007bff; font-size: 0.9em; display: flex; align-items: center; gap: 4px;">
                            üì∏ Ïù¥ÎØ∏ÏßÄ
                        </label>
                        <input type="file" name="image" id="image-input" accept="image/*" style="display: none;">
                        {% endif %}
                        <button type="submit">Ï†ÑÏÜ°</button>
                    </div>
                    {% if vision_enabled %}
                    <div id="image-preview" style="display: none; margin-top: 8px;">
                        <img id="preview-image" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid #ddd;">
                        <button type="button" id="remove-image" style="margin-left: 8px; padding: 4px 8px; background: #ff6b6b; color: white; border: none; border-radius: 4px; font-size: 0.8em;">‚ùå Ï†úÍ±∞</button>
                    </div>
                    {% endif %}
                </div>
            </form>
        </div>
        <div style="width:210px; min-width:170px; background:#f8faff; border-radius:14px; box-shadow:0 2px 12px #e0e7ef; padding:22px 14px; margin-left:8px;">
            <div style="display:flex; flex-direction:column; gap:8px; margin-bottom:12px;">
                <div style="display:flex; flex-direction:row; align-items:center; justify-content:space-between;">
                    <span style="font-weight:bold; color:#007bff; font-size:1.08em;">DOFBOT Í∞ÅÎèÑ</span>
                </div>
                <div style="display:flex; justify-content:center; gap:3px; flex-wrap:wrap;">
                    <button id="home-btn" title="Ìôà ÏûêÏÑ∏Î°ú Î≥µÍ∑Ä" style="background:none; border:none; cursor:pointer; padding:2px 4px;">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 3L3 10h2v7h4v-4h2v4h4v-7h2L10 3z" stroke="#007bff" stroke-width="1.5" fill="none"/></svg>
                    </button>
                    <button id="replay-btn" title="ÎèôÏûë Ïû¨Ïã§Ìñâ" style="background:none; border:none; cursor:pointer; padding:2px 4px;">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M4 10a6 6 0 1 1 6 6v-2l-3 3 3 3v-2a8 8 0 1 0-8-8h2z" stroke="#007bff" stroke-width="1.5" fill="none"/></svg>
                    </button>
                    <button id="emergency-btn" title="Í∏¥Í∏âÏ†ïÏßÄ" style="background:none; border:none; cursor:pointer; padding:2px 4px;">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><circle cx="10" cy="10" r="8" stroke="#ff3333" stroke-width="2" fill="none"/><rect x="6" y="6" width="8" height="8" rx="2" fill="#ff3333"/></svg>
                    </button>
                    <button id="clear-btn" title="ÎåÄÌôîÎÇ¥Ïó≠ÏßÄÏö∞Í∏∞" style="background:none; border:none; cursor:pointer; padding:2px 4px; border-radius:4px; background:#f0f7ff;">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><rect x="3" y="5" width="14" height="10" rx="2" stroke="#007bff" stroke-width="1.5" fill="none"/><path d="M7 8v4M10 8v4M13 8v4" stroke="#007bff" stroke-width="1.5"/></svg>
                    </button>
                    <button id="memory-btn" title="ÌïôÏäµ ÏÉÅÌÉú Î≥¥Í∏∞" style="background:none; border:none; cursor:pointer; padding:2px 4px; border-radius:4px; background:#f0fff4;">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><circle cx="10" cy="10" r="8" stroke="#28a745" stroke-width="1.5" fill="none"/><path d="M6 10l3 3 5-6" stroke="#28a745" stroke-width="1.5" fill="none"/></svg>
                    </button>
                </div>
            </div>
            <div style="display:flex; flex-direction:column; gap:12px;">
                <div style="background:#fff; border-radius:8px; box-shadow:0 1px 4px #e0e7ef; padding:10px 12px; display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-weight:500; color:#555;">grip</span>
                    <span id="angle-grip" style="font-weight:bold; color:#007bff;">-</span>
                    <button class="edit-angle-btn" data-motor="grip" title="ÏàòÏ†ï" style="background:none; border:none; cursor:pointer; margin-left:8px;">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><path d="M3 17v-2.5l10-10a1.77 1.77 0 0 1 2.5 2.5l-10 10H3zm13-13a2.5 2.5 0 0 1 0 3.5l-1.5-1.5a2.5 2.5 0 0 1 1.5-2z" stroke="#007bff" stroke-width="1.5" fill="none"/></svg>
                    </button>
                </div>
                <div style="background:#fff; border-radius:8px; box-shadow:0 1px 4px #e0e7ef; padding:10px 12px; display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-weight:500; color:#555;">grip_rotate</span>
                    <span id="angle-grip_rotate" style="font-weight:bold; color:#007bff;">-</span>
                    <button class="edit-angle-btn" data-motor="grip_rotate" title="ÏàòÏ†ï" style="background:none; border:none; cursor:pointer; margin-left:8px;">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><path d="M3 17v-2.5l10-10a1.77 1.77 0 0 1 2.5 2.5l-10 10H3zm13-13a2.5 2.5 0 0 1 0 3.5l-1.5-1.5a2.5 2.5 0 0 1 1.5-2z" stroke="#007bff" stroke-width="1.5" fill="none"/></svg>
                    </button>
                </div>
                <div style="background:#fff; border-radius:8px; box-shadow:0 1px 4px #e0e7ef; padding:10px 12px; display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-weight:500; color:#555;">motor3</span>
                    <span id="angle-motor3" style="font-weight:bold; color:#007bff;">-</span>
                    <button class="edit-angle-btn" data-motor="motor3" title="ÏàòÏ†ï" style="background:none; border:none; cursor:pointer; margin-left:8px;">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><path d="M3 17v-2.5l10-10a1.77 1.77 0 0 1 2.5 2.5l-10 10H3zm13-13a2.5 2.5 0 0 1 0 3.5l-1.5-1.5a2.5 2.5 0 0 1 1.5-2z" stroke="#007bff" stroke-width="1.5" fill="none"/></svg>
                    </button>
                </div>
                <div style="background:#fff; border-radius:8px; box-shadow:0 1px 4px #e0e7ef; padding:10px 12px; display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-weight:500; color:#555;">motor2</span>
                    <span id="angle-motor2" style="font-weight:bold; color:#007bff;">-</span>
                    <button class="edit-angle-btn" data-motor="motor2" title="ÏàòÏ†ï" style="background:none; border:none; cursor:pointer; margin-left:8px;">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><path d="M3 17v-2.5l10-10a1.77 1.77 0 0 1 2.5 2.5l-10 10H3zm13-13a2.5 2.5 0 0 1 0 3.5l-1.5-1.5a2.5 2.5 0 0 1 1.5-2z" stroke="#007bff" stroke-width="1.5" fill="none"/></svg>
                    </button>
                </div>
                <div style="background:#fff; border-radius:8px; box-shadow:0 1px 4px #e0e7ef; padding:10px 12px; display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-weight:500; color:#555;">motor1</span>
                    <span id="angle-motor1" style="font-weight:bold; color:#007bff;">-</span>
                    <button class="edit-angle-btn" data-motor="motor1" title="ÏàòÏ†ï" style="background:none; border:none; cursor:pointer; margin-left:8px;">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><path d="M3 17v-2.5l10-10a1.77 1.77 0 0 1 2.5 2.5l-10 10H3zm13-13a2.5 2.5 0 0 1 0 3.5l-1.5-1.5a2.5 2.5 0 0 1 1.5-2z" stroke="#007bff" stroke-width="1.5" fill="none"/></svg>
                    </button>
                </div>
                <div style="background:#fff; border-radius:8px; box-shadow:0 1px 4px #e0e7ef; padding:10px 12px; display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-weight:500; color:#555;">base</span>
                    <span id="angle-base" style="font-weight:bold; color:#007bff;">-</span>
                    <button class="edit-angle-btn" data-motor="base" title="ÏàòÏ†ï" style="background:none; border:none; cursor:pointer; margin-left:8px;">
                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><path d="M3 17v-2.5l10-10a1.77 1.77 0 0 1 2.5 2.5l-10 10H3zm13-13a2.5 2.5 0 0 1 0 3.5l-1.5-1.5a2.5 2.5 0 0 1 1.5-2z" stroke="#007bff" stroke-width="1.5" fill="none"/></svg>
                    </button>
                </div>
            </div>
        </div>
        <style>
        .bubble.pending {
            opacity: 0.7;
            animation: fadeBlink 1.2s infinite;
        }
        @keyframes fadeBlink {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        </style>
    <!-- lightweight toast container -->
    <div id="toast" style="position:fixed; bottom:24px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); color:#fff; padding:10px 14px; border-radius:8px; font-size:0.95em; display:none; z-index:9999;">ÏïåÎ¶º</div>
        <script src="/static/angles.js"></script>
        <script src="/static/chat.js"></script>
